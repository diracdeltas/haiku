<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>haikubot</title>
    <style>
      @media print {
        * {
          -webkit-print-color-adjust: exact !important;
        }
        body {
          width: 500px;
          background: no-repeat;
        }
        .noprint {
          display: none;
        }
      }
    </style>
  </head>
  <body style='font-size:20; -webkit-print-color-adjust:exact;'>
    <input class='noprint' placeholder='enter a haiku theme'>
    <button class='noprint' id='button'>generate</button>
    <div id='result' style='width:484px; margin-top:20px; background:rgba(255,255,255,0.5);'></div>
    <button class='noprint' id='print' style='visibility:hidden; margin-top:20px;'>print card</button>
  </body>
  <script>
    const input = document.querySelector('input');
    const button = document.querySelector('#button');
    const result = document.querySelector('#result');
    const body = document.querySelector('body');
    const print = document.querySelector('#print');
    print.onclick = () => {
      window.print();
    };
    button.onclick = () => {
      print.style.visibility = 'hidden';
      const rand = Math.ceil(Math.random() * 746);
      const background = `./img/${rand}.jpg`;
      body.style.backgroundImage = `url("${background}")`;
      result.innerText = 'churning...';
      const words = input.value;
      fetch(`/api?${new URLSearchParams({words})}`).then((response) => response.text()).then((text) => {
        result.innerText = text;
        print.style.visibility = 'visible';
      });
    };
    input.addEventListener('keyup', (event) => {
      if (event.key === 'Enter') {
        button.onclick();
      }
    });
  </script>
</html>
